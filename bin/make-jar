#!/bin/sh

HERE=`pwd -P`
JARHOME=$1
CLASSES=classes
NSCOMPILE=$HERE/etc/compile
JARS=$HERE/etc/jars

mkdir -p $CLASSES

for jarname in `cat $JARS`; do
  jar=$JARHOME/$jarname
  echo Packaging $jar
  ( cd $CLASSES
    jar tvf $jar | egrep "\.class|\.clj" | xargs jar xf $jar )
done

java \
  -cp src:$CLASSES \
  -Dclojure.compile.path=$CLASSES \
  clojure.lang.Compile \
  `cat $NSCOMPILE | xargs echo` \
&& \
( cd $CLASSES
  jar cfe \
    $JARHOME/clot.jar \
    com.draines.clot.main \
    . ) \
&& rm -rf $CLASSES
